@startuml
title Repository Pattern Architecture - Trust System

package "Domain Layer" <<Rectangle>> {
    interface TrustRelationRepository {
        +Create(ctx, trust): error
        +GetByID(ctx, id): *TrustRelation, error
        +Delete(ctx, id): error
        +GetTrustedByAdmin(ctx, adminID, platform): []*TrustRelation, error
        +GetTrustersOfAdmin(ctx, adminID, platform): []*TrustRelation, error
        +Exists(ctx, trusterID, trustedID, platform): bool, error
        +AddTargetChat(ctx, trustID, chat): error
        +RemoveTargetChat(ctx, trustID, chat): error
        +GetTargetChats(ctx, trustID): []ChatTarget, error
    }
    
    interface AdminChatRepository {
        +Create(ctx, relation): error
        +Update(ctx, relation): error
        +GetAdminChats(ctx, adminID, platform): []*AdminChatRelation, error
        +GetChatAdmins(ctx, platform, chatID): []*AdminChatRelation, error
        +IsAdmin(ctx, adminID, platform, chatID): bool, error
        +CanBan(ctx, adminID, platform, chatID): bool, error
        +SyncFromPlatform(ctx, adminID, platform, chats): error
    }
    
    interface BanEventRepository {
        +Create(ctx, event): error
        +GetByID(ctx, id): *BanEventRecord, error
        +GetByEventID(ctx, eventID): *BanEventRecord, error
        +GetByInitiator(ctx, adminID, platform, limit): []*BanEventRecord, error
        +GetUserHistory(ctx, platform, userID, limit): []*BanEventRecord, error
        +GetChatHistory(ctx, platform, chatID, limit): []*BanEventRecord, error
        +Search(ctx, filter): []*BanEventRecord, error
    }
    
    interface SyncLogRepository {
        +Create(ctx, log): error
        +Update(ctx, log): error
        +GetByID(ctx, id): *SyncLog, error
        +GetByBanEventID(ctx, eventID): []*SyncLog, error
        +GetByTrustRelation(ctx, trustID): []*SyncLog, error
        +GetFailedSyncs(ctx, maxRetry, limit): []*SyncLog, error
    }
    
    interface CacheRepository {
        +Set(ctx, key, value, ttl): error
        +Get(ctx, key, dest): error
        +Delete(ctx, key): error
        +Exists(ctx, key): bool, error
    }
}

package "Repository Implementation (PostgreSQL)" <<Database>> {
    class PostgresTrustRelationRepository {
        -db: *sql.DB
        +Create(ctx, trust): error
        +GetByID(ctx, id): *TrustRelation, error
        +Delete(ctx, id): error
        +GetTrustedByAdmin(ctx, adminID, platform): []*TrustRelation, error
        +GetTrustersOfAdmin(ctx, adminID, platform): []*TrustRelation, error
        +Exists(ctx, trusterID, trustedID, platform): bool, error
        +AddTargetChat(ctx, trustID, chat): error
        +RemoveTargetChat(ctx, trustID, chat): error
        +GetTargetChats(ctx, trustID): []ChatTarget, error
    }
    
    class PostgresAdminChatRepository {
        -db: *sql.DB
        +Create(ctx, relation): error
        +Update(ctx, relation): error
        +GetAdminChats(ctx, adminID, platform): []*AdminChatRelation, error
        +GetChatAdmins(ctx, platform, chatID): []*AdminChatRelation, error
        +IsAdmin(ctx, adminID, platform, chatID): bool, error
        +CanBan(ctx, adminID, platform, chatID): bool, error
        +SyncFromPlatform(ctx, adminID, platform, chats): error
    }
    
    class PostgresBanEventRepository {
        -db: *sql.DB
        +Create(ctx, event): error
        +GetByID(ctx, id): *BanEventRecord, error
        +GetByEventID(ctx, eventID): *BanEventRecord, error
        +GetByInitiator(ctx, adminID, platform, limit): []*BanEventRecord, error
        +GetUserHistory(ctx, platform, userID, limit): []*BanEventRecord, error
        +GetChatHistory(ctx, platform, chatID, limit): []*BanEventRecord, error
        +Search(ctx, filter): []*BanEventRecord, error
    }
    
    class PostgresSyncLogRepository {
        -db: *sql.DB
        +Create(ctx, log): error
        +Update(ctx, log): error
        +GetByID(ctx, id): *SyncLog, error
        +GetByBanEventID(ctx, eventID): []*SyncLog, error
        +GetByTrustRelation(ctx, trustID): []*SyncLog, error
        +GetFailedSyncs(ctx, maxRetry, limit): []*SyncLog, error
    }
}

package "Repository Implementation (Redis)" <<Database>> {
    class RedisCacheRepository {
        -client: *redis.Client
        +Set(ctx, key, value, ttl): error
        +Get(ctx, key, dest): error
        +Delete(ctx, key): error
        +Exists(ctx, key): bool, error
    }
}

TrustRelationRepository <|.. PostgresTrustRelationRepository
AdminChatRepository <|.. PostgresAdminChatRepository
BanEventRepository <|.. PostgresBanEventRepository
SyncLogRepository <|.. PostgresSyncLogRepository
CacheRepository <|.. RedisCacheRepository

@enduml