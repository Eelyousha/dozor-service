@startuml
title Package Dependencies - Trust-Based System

package "Presentation Layer" {
    [API Handlers]
    [Webhook Handlers]
}

package "Application Layer" {
    [Trust Service]
    [Admin Chat Service]
    [Ban Event Service]
    [Sync Service]
    [Notification Service]
}

package "Domain Layer" {
    [Domain Models]
    [Repository Interfaces]
    [Service Interfaces]
    [Platform Adapter Interface]
}

package "Infrastructure Layer" {
    [PostgreSQL Repository]
    [Redis Repository]
    [RabbitMQ Publisher]
    [RabbitMQ Consumer]
}

package "Platform Layer" {
    [Telegram Adapter]
    [VK Adapter]
    [Discord Adapter]
    [Platform Factory]
}

package "External" {
    [PostgreSQL Database]
    [Redis Cache]
    [RabbitMQ]
    [Telegram API]
    [VK API]
    [Discord API]
}

[API Handlers] --> [Trust Service]
[API Handlers] --> [Admin Chat Service]
[API Handlers] --> [Ban Event Service]
[Webhook Handlers] --> [Platform Factory]

[Trust Service] --> [Repository Interfaces]
[Admin Chat Service] --> [Repository Interfaces]
[Ban Event Service] --> [Repository Interfaces]

[Sync Service] --> [Repository Interfaces]
[Sync Service] --> [Trust Service]
[Sync Service] --> [Admin Chat Service]
[Sync Service] --> [Platform Adapter Interface]

[Notification Service] --> [Platform Adapter Interface]

[Repository Interfaces] <|.. [PostgreSQL Repository]
[Repository Interfaces] <|.. [Redis Repository]

[Platform Adapter Interface] <|.. [Telegram Adapter]
[Platform Adapter Interface] <|.. [VK Adapter]
[Platform Adapter Interface] <|.. [Discord Adapter]

[PostgreSQL Repository] --> [PostgreSQL Database]
[Redis Repository] --> [Redis Cache]
[RabbitMQ Publisher] --> [RabbitMQ]
[RabbitMQ Consumer] --> [RabbitMQ]

[Telegram Adapter] --> [Telegram API]
[VK Adapter] --> [VK API]
[Discord Adapter] --> [Discord API]

note right of [Sync Service]
  Core logic:
  1. Self-sync (admin's own chats)
  2. Trust-sync (trusters' chats)
  Depends on Trust & AdminChat services
end note

note right of [Domain Layer]
  New entities:
  - TrustRelation
  - AdminChatRelation
  - Updated BanEventRecord
    (with initiator_admin_id)
end note

@enduml